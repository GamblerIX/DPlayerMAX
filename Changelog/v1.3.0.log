# DPlayerMAX v1.3.0 更新日志

## 发布日期
2025-11-29

## 新增功能

### B站视频解析
- 新增 B站视频解析功能，支持直接使用 B站视频链接
- 支持免登录 1080P 高清播放
- 实现完整的 WBI 签名机制
- 支持 BV 号和 AV 号格式
- 支持分P视频解析
- 自动识别 B站链接
- 智能缓存系统（WBI密钥缓存1小时，视频信息缓存2小时）

### 配置选项
- 新增 B站视频解析开关
- 新增 B站默认清晰度选择（1080P/720P/480P/360P）
- 优化配置界面，分组显示设置项

## 使用方法

### 基本用法
```
[dplayer url="https://www.bilibili.com/video/BV133xFzKEsd/"]
```

### 指定分P
```
[dplayer url="https://www.bilibili.com/video/BV133xFzKEsd/" page="2"]
```

### 指定清晰度
```
[dplayer url="https://www.bilibili.com/video/BV133xFzKEsd/" quality="1080p"]
```

### 强制使用 B站解析
```
[dplayer url="https://www.bilibili.com/video/BV133xFzKEsd/" bilibili="true"]
```

## 技术特性

### WBI 签名机制
- 完整实现 B站 WBI 签名算法
- 密钥自动获取和缓存
- 支持密钥过期自动刷新

### BV/AV 转换
- 实现新版 BV/AV 转换算法
- 支持所有现有和新发布的视频

### 缓存系统
- WBI 密钥缓存：1 小时
- 视频信息缓存：2 小时
- 播放地址缓存：100 分钟
- 自动清理过期缓存

### 错误处理
- 友好的错误提示
- 解析失败时显示原视频链接
- 清晰度自动降级

## 项目结构更新

```
ext/
└── bilibili/
    ├── WbiSigner.php       # WBI 签名器
    ├── BilibiliParser.php  # B站解析器
    └── cache/              # 缓存目录（自动创建）
```

## 兼容性

- PHP 7.0+
- Typecho 1.2+
- 需要 cURL 扩展支持

## 注意事项

1. B站视频解析功能需要在插件设置中手动开启
2. 部分视频可能需要大会员权限，无法免登录播放
3. 视频播放地址有时效性，缓存会自动刷新
4. 建议开启 HLS 支持以获得更好的兼容性
